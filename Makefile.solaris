# Makefile for Solaris nss_ldap

# Copyright (C) 1997 Luke Howard.
# This file is part of the nss_ldap Library.

# The nss_ldap library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.

# The nss_ldap Library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Library General Public License for more details.

# You should have received a copy of the GNU Library General Public
# License along with the nss_ldap Library; see the file COPYING.LIB.  If not,
# write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.

#
# $Id$
#

MODULE=nss_ldap
HDRS=	\
	ldap-alias.h \
	ldap-ethers.h \
	ldap-grp.h \
	ldap-hosts.h \
	ldap-netgrp.h \
	ldap-network.h \
	ldap-nss.h \
	ldap-proto.h \
	ldap-pwd.h \
	ldap-rpc.h \
	ldap-service.h \
	ldap-spwd.h \
	util.h \
	globals.h \
	ltf.h \
	irs-nss.h \
	ldap-parse.h \
	snprintf.h \
	resolve.h \
	dnsconfig.h

SRCS=	ldap-nss.c \
	ldap-pwd.c \
	ldap-grp.c \
	ldap-rpc.c \
	ldap-hosts.c \
	ldap-network.c \
	ldap-proto.c \
	ldap-spwd.c \
	ldap-alias.c \
	ldap-service.c \
	ldap-ethers.c \
	ldap-bp.c \
	util.c \
	globals.c \
	ltf.c \
	snprintf.c \
	resolve.c \
	dnsconfig.c

OBJS=$(SRCS:.c=.o)
LIB=$(MODULE).so.1

# uncomment NSFLAGS if you are using the Netscape SDK
#NSFLAGS=-I/usr/local/ldapsdk/include -DLDAP_VERSION3_API -DRFC2307BIS

# uncomment GNUFLAGS if you are building a GNU glibc-2.x module
#GNUFLAGS=-DGNU_NSS

# uncomment BSDFLAGS if you are building this as part of the BIND IRS
#BSDFLAGS=-DIRS_NSS

# uncomment this SUNFLAGS if you're building under Solaris 2.5 
#SUNFLAGS=-DSUN_NSS -D_REENTRANT

# uncomment this SUNFLAGS if you're building under Solaris 2.6
SUNFLAGS=-DSUN_NSS -D_REENTRANT -DHAVE_SNPRINTF -D__EXTENSIONS__
INCDIRS=-I/usr/local/include -I../libldap
LIBDIRS=-L/usr/local/lib -R/usr/ucblib

# uncomment this LIBS if you're linking against my PIC LDAP libs
#LIBS=-lldap_pic -llber_pic -lnsl
# uncomment this if you're linking against Sun or Netscape's libldap.so
# or using UMich libldap/liblber compiled into one library
LIBS=-lldap -lnsl -lresolv

# uncomment this if you're using gcc
GCCFLAGS=-O -g -Wall -fPIC
# don't know about these CFLAGS?
#SUNCFLAGS=-g -pic
# these are the flags wcs@sun used
SUNCFLAGS=-O -G -K pic
SUNLDFLAGS=-G -z text
DEBUGFLAGS=

# choose your C compiler
#CC=/usr/local/opt/SUNWspro/bin/cc
#CC=cc
#COMPILERFLAGS=$(SUNCFLAGS)
#LD=$(CC)
#LDFLAGS=$(SUNLDFLAGS)

CC=gcc
COMPILERFLAGS=$(GCCFLAGS)

# These "GNU" flags seem to work OK, with Sun CC too ???
LD=ld
GNULDFLAGS=-G -dy -z text
LDFLAGS=$(GNULDFLAGS)

CFLAGS=-DLDAP_REFERRALS $(DEBUGFLAGS) $(NSFLAGS) $(SUNFLAGS) $(BSDFLAGS) $(GNUFLAGS) $(COMPILERFLAGS) $(INCDIRS)

all: $(MODULE) 

$(MODULE): $(OBJS)
	$(LD) $(LIBDIRS) $(LDFLAGS) -o $(LIB) $(OBJS) $(LIBS)

install:
	cp $(LIB) /usr/lib/

clean:
	rm -f $(OBJS) $(LIB)

